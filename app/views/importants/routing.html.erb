<%= render "tabbar"%>

<div class="mapbar">
  <div id="allmap"></div>
</div>

<% content_for :scripts do %>
  <%= javascript_include_tag baidu_api(ENV['baidukey']), 'data-turbolinks-track' => false %>
  <%= javascript_include_tag "http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js", 'data-turbolinks-track' => false %>
  <%= javascript_include_tag "http://api.map.baidu.com/library/CurveLine/1.5/src/CurveLine.min.js", 'data-turbolinks-track' => false %>
  <script type="text/javascript">
    var map = new BMap.Map("allmap");
    var point = new BMap.Point(123.246378, 30.353831);
    map.centerAndZoom(point, 8);  // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom();  //开启鼠标滚轮缩放
    //地图的高度等于屏幕的高度
    var c_Height=$(document).height();
    $(".mapbar").css("height",c_Height);

    //添加台风覆盖图
    var pt = new BMap.Point(123.246378, 30.353831);
    var image = "http://ww4.sinaimg.cn/thumbnail/738e4c72gw1ey7ixk7ltdg203k03k3yg.gif"
    var myIcon = new BMap.Icon(image, new BMap.Size(300,300));
    var marker2 = new BMap.Marker(pt,{icon:myIcon});  // 创建标注
    map.addOverlay(marker2);

    //台风覆盖图到上海市中心弧线
    var shanghaiPosition = new BMap.Point(121.540295, 31.341296)
    var taifengPosition = new BMap.Point(123.246378, 30.353831)
    var points = [taifengPosition, shanghaiPosition];
    var curve = new BMapLib.CurveLine(points, {strokeColor:"red", strokeWeight:3, strokeOpacity:0.5}); //创建弧线对象
    map.addOverlay(curve); //添加到地图中
  </script>
<% end %>

<style type="text/css">
  .mapbar {
    height: 500px;
    width: 100%;
  }
  #allmap {
    width: 100%;
    height: 100%;
  }
</style>