<% content_for :title do %>
  天气信息
<% end %>

<% content_for :scripts do %>
  <%= javascript_include_tag "touchswip.min" %>
  <script type="text/javascript">
    $(function() {
      cWidth = $('body').width();
      $("#weatherPro li").css("width", cWidth*0.25);
      var IMG_WIDTH = cWidth;
      var currentImg = 0;
      var maxImages = 3;
      var speed = 200;

      var imgs;

      var swipeOptions = {
        triggerOnTouchEnd: true,
        swipeStatus: swipeStatus,
        allowPageScroll: "vertical",
        threshold: 75
      };

      $(function () {
        imgs = $("#weatherPro");
        imgs.swipe(swipeOptions);
      });
      function swipeStatus(event, phase, direction, distance) {
        //If we are moving before swipe, and we are going L or R in X mode, or U or D in Y mode then drag.
        if (phase == "move" && (direction == "left" || direction == "right")) {
            var duration = 0;

            if (direction == "left") {
                scrollImages((IMG_WIDTH * currentImg) + distance, duration);
            } else if (direction == "right") {
                scrollImages((IMG_WIDTH * currentImg) - distance, duration);
            }

        } else if (phase == "cancel") {
            scrollImages(IMG_WIDTH * currentImg, speed);
        } else if (phase == "end") {
            if (direction == "right") {
                previousImage();
            } else if (direction == "left") {
                nextImage();
            }
        }
      }
      function previousImage() {
        currentImg = Math.max(currentImg - 1, 0);
        scrollImages(IMG_WIDTH * currentImg, speed);
      }

      function nextImage() {
        currentImg = Math.min(currentImg + 1, maxImages - 1);
        scrollImages(IMG_WIDTH * currentImg, speed);
      }
      function scrollImages(distance, duration) {
        imgs.css("transition-duration", (duration / 1000).toFixed(1) + "s");

        //inverse the number we set in the css
        var value = (distance < 0 ? "" : "-") + Math.abs(distance).toString();
        imgs.css("transform", "translate(" + value + "px,0)");
      }
    });
  </script>
<% end %>

<div class="topbar">
  <div class="title">上海中心气象台<%= @now %>发布</div>
  <div class="weather-logo">
    <%= image_tag Weather.get_weather_icons(@weather_info_first["weatherpic"])['pic'][0] %>
    <h3><%= @weather_info_first["weather"] %></h3>
  </div>
  <div class="weather-info">
    <ul>
      <li>
        <%= image_tag("svg/wind.svg")%>
        <span><%= @weather_info_first["direction"] %><%= @weather_info_first["speed"] %></span>
      </li>
      <li>
        <%= image_tag("svg/wendu.svg")%>
        <span><%= @weather_info_first["tempe"] %></span>
      </li>
      <li>
        <%= image_tag("svg/car.svg")%>
        <span><%= @life_info %></span>
      </li>
      <li>
        <%= image_tag("svg/leaf.svg")%>
        <span><%= @aqi_info['aqi']%></span>
        <span class=<%= aqi_level[@aqi_info['level']]%>><%= @aqi_info['level']%></span>
      </li>
    </ul>
  </div>
</div>

<div class="weather-list">
  <ul id="weatherPro">
    <% @weather_info.each_with_index do |weather, index|%>
      <!-- 此处背景要使用奇偶变色 -->
      <% if index.odd? %>
        <li>
      <% else %>
        <li class="bg">
      <% end %>
        <p><%= weather["datatime"] %></p>
        <p><%= get_weekday weather["datatime"] %></p>
        <%= image_tag(Weather.get_weather_icons(weather["weatherpic"])['active_pic'][0])%>
        <p><%= weather["weather"][0..3] %></p>
        <p><%= weather["tempe"] %></p>
      </li>
    <% end %>
  </ul>
</div>